{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}

<style>
    .boutt{
        background-color: #059669;
    }
    .text{
        font-size: 18px;
    }
</style>
<div class="max-w-3xl mx-auto p-4 md:p-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-6 flex items-center">
        <div class="bg-emerald-100 p-3 rounded-full mr-4">
            <i class="fas fa-car text-emerald-600 text-2xl"></i>
        </div>
        <div>
            <h1 class="text-2xl font-bold text-gray-800 text">PROGRAMME NATIONAL D'AMENAGEMENT DES ZONES
                D'ACTIVITES DES MECANICIENS ET AUTRES ARTISANS</h1>
            <p class="text-gray-600">Veuillez remplir toutes les sections du formulaire</p>
        </div>
    </div>
    
    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        
        <!-- Section 1-2: Informations de base et localisation -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-info-circle me-2"></i>1. Informations de l'enquête & 2. Localisation</h5>
            </div>
            <div class="bg-gray-50 p-6 space-y-6">
                
                <!-- Date de l'enquête -->
                <div class="w-full">
                    <label class="block text-sm font-medium text-gray-700">Date de l'enquête</label>
                    {{ form.date_enquete }}
                </div>
        
                <!-- Coordonnées GPS -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Latitude</label>
                        {{ form.latitude }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Longitude</label>
                        {{ form.longitude }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Altitude</label>
                        {{ form.altitude }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Précision</label>
                        {{ form.precision }}
                    </div>
                </div>
        
                <!-- Localisation -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Département</label>
                        {{ form.departement }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Commune</label>
                        {{ form.commune }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Quartier</label>
                        {{ form.quartier }}
                    </div>
                </div>
        
            </div>
        </div>
        
        

        <!-- Section 6-9: Personnes concernées -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-users me-2"></i>6-9. Personnes concernées</h5>
            </div>
            <div class="bg-gray-50 p-6 space-y-6">
                
                <!-- Enquêteur -->
                <div>
                    <h6 class="font-medium text-gray-700 mb-2 border-b pb-1">Enquêteur</h6>
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Prénom enquêteur</label>
                            {{ form.prenom_enqueteur }}
                        </div>
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Nom enquêteur</label>
                            {{ form.nom_enqueteur }}
                        </div>
                    </div>
                </div>
        
                <!-- Propriétaire -->
                <div>
                    <h6 class="font-medium text-gray-700 mb-2 border-b pb-1">Propriétaire</h6>
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Prénom propriétaire</label>
                            {{ form.prenom_proprietaire }}
                        </div>
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Nom propriétaire</label>
                            {{ form.nom_proprietaire }}
                        </div>
                    </div>
                </div>
        
                <!-- Chef d'atelier -->
                <div>
                    <h6 class="font-medium text-gray-700 mb-2 border-b pb-1">Chef d'atelier</h6>
                    <div class="flex flex-col md:flex-row gap-4 mb-4">
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Prénom chef d'atelier</label>
                            {{ form.prenom_chef_atelier }}
                        </div>
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-medium text-gray-600">Nom chef d'atelier</label>
                            {{ form.nom_chef_atelier }}
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600">Téléphone du chef</label>
                        {{ form.telephone_chef }}
                    </div>
                </div>
        
            </div>
        </div>
        

        <!-- Section 10-13: Démographie -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-user-tag me-2"></i>10-13. Informations démographiques</h5>
            </div>
            <div class="bg-gray-50 p-6 space-y-6">
                
                <!-- Informations de base -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Sexe</label>
                        {{ form.sexe }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Date de naissance</label>
                        {{ form.date_naissance }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Numéro CNI</label>
                        {{ form.cni }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Niveau d'étude</label>
                        {{ form.niveau_etude }}
                    </div>
                </div>
        
                <!-- Affichage conditionnel autre niveau d'étude -->
                <div id="autre_niveau_etude_row" class="mt-4" {% if form.niveau_etude.value != 'autre' %}style="display: none;"{% endif %}>
                    <label class="block text-sm font-medium text-gray-700">Autre niveau d'étude</label>
                    {{ form.autre_niveau_etude }}
                </div>
        
            </div>
        </div>
        

        <!-- Section 14-18: Activité professionnelle -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-briefcase me-2"></i>14-18. Activité professionnelle</h5>
            </div>
            <div class="bg-gray-50 p-6 space-y-6">
        
                <!-- Profession -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Profession</label>
                    {{ form.profession }}
                </div>
        
                <!-- Type d'activité + Autre -->
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label class="block text-sm font-medium text-gray-700">Type d'activité</label>
                        {{ form.type_activite }}
                    </div>
                    <div class="w-full md:w-1/2" id="autre_activite_row" {% if form.type_activite.value != 'autre' %}style="display: none;"{% endif %}>
                        <label class="block text-sm font-medium text-gray-700">Autre activité</label>
                        {{ form.autre_activite }}
                    </div>
                </div>
        
                <!-- Revenus -->
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label class="block text-sm font-medium text-gray-700">Revenu journalier</label>
                        {{ form.revenu_journalier }}
                    </div>
                    <div class="w-full md:w-1/2">
                        <label class="block text-sm font-medium text-gray-700">Revenu mensuel</label>
                        {{ form.revenu_mensuel }}
                    </div>
                </div>
        
            </div>
        </div>
        

        <!-- Section 19-28: Statut d'occupation -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-home me-2"></i>19-28. Statut d'occupation</h5>
            </div>
            <div class="bg-gray-50 p-6 space-y-6">
        
                <!-- Statut d'occupation -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Statut d'occupation</label>
                        {{ form.statut_occupation }}
                    </div>
                    <div id="statut_non_proprietaire_section" {% if form.statut_occupation.value != 'exploitant_non_proprietaire' %}style="display:none;"{% endif %}>
                        <label class="block text-sm font-medium text-gray-700">Statut non propriétaire</label>
                        {{ form.statut_non_proprietaire }}
        
                        <div id="autre_statut_non_proprietaire_row" class="mt-3" {% if form.statut_non_proprietaire.value != 'autre' %}style="display:none;"{% endif %}>
                            <label class="block text-sm font-medium text-gray-700">Autre statut</label>
                            {{ form.autre_statut_non_proprietaire }}
                        </div>
        
                        <div id="loyer_mensuel_row" class="mt-3" {% if form.statut_non_proprietaire.value != 'locataire' %}style="display:none;"{% endif %}>
                            <label class="block text-sm font-medium text-gray-700">Loyer mensuel</label>
                            {{ form.loyer_mensuel }}
                        </div>
                    </div>
                </div>
        
                <!-- Année d'installation + Mode d'acquisition -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Année d'installation</label>
                        {{ form.annee_installation }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Mode d'acquisition</label>
                        {{ form.acquisition_site }}
                    </div>
                </div>
        
                <!-- Autre mode d'acquisition -->
                <div id="autre_acquisition_row" class="mt-4" {% if form.acquisition_site.value != 'autre' %}style="display:none;"{% endif %}>
                    <label class="block text-sm font-medium text-gray-700">Autre mode d'acquisition</label>
                    {{ form.autre_acquisition }}
                </div>
        
                <!-- Déjà déguerpi -->
                <div class="pt-6 border-t border-gray-200">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Avez-vous une fois été déguerpi ?</label>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2">
                            <input type="radio" name="deja_deguerpi" id="deguerpi_oui" value="True"
                                   class="text-emerald-600 focus:ring-emerald-500"
                                   {% if form.deja_deguerpi.value %}checked{% endif %}>
                            <span>Oui</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="radio" name="deja_deguerpi" id="deguerpi_non" value="False"
                                   class="text-emerald-600 focus:ring-emerald-500"
                                   {% if form.deja_deguerpi.value == False %}checked{% endif %}>
                            <span>Non</span>
                        </label>
                    </div>
        
                    <div id="lieu_provenance_container" class="mt-4 {% if not form.deja_deguerpi.value %}hidden{% endif %}">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Si Oui, quel est votre lieu de provenance ?
                        </label>
                        {{ form.lieu_provenance }}
                        {% if form.lieu_provenance.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.lieu_provenance.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
        
                <!-- Meilleur site -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Quel serait le meilleur site pour vous ?</label>
                    {{ form.meilleur_site }}
                </div>
        
            </div>
        </div>
        

        <!-- Section 29-36: Situation juridique -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-gavel me-2"></i>29-36. Situation juridique</h5>
            </div>
        
            <div class="bg-gray-50 p-6 space-y-6">
                <!-- Menaces d'expulsion -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Avez-vous une fois reçu des menaces d'expulsion sur le site que vous occupez actuellement ?
                    </label>
                    <div class="flex space-x-6">
                        <label class="flex items-center space-x-2">
                            <input type="radio" name="menaces_expulsion" id="menaces_oui" value="True"
                                   class="text-emerald-600 focus:ring-emerald-500"
                                   {% if form.menaces_expulsion.value %}checked{% endif %}>
                            <span>Oui</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="radio" name="menaces_expulsion" id="menaces_non" value="False"
                                   class="text-emerald-600 focus:ring-emerald-500"
                                   {% if form.menaces_expulsion.value == False %}checked{% endif %}>
                            <span>Non</span>
                        </label>
                    </div>
        
                    <div id="auteur_menaces_container" class="mt-4 {% if not form.menaces_expulsion.value %}hidden{% endif %}">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Si oui, de qui ?
                        </label>
                        {{ form.auteur_menaces }}
                        {% if form.auteur_menaces.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.auteur_menaces.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
        
                <!-- Champs juridiques -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nature juridique</label>
                        {{ form.nature_juridique }}
                    </div>
                    <div id="autre_nature_juridique_row" {% if form.nature_juridique.value != 'autre' %}style="display:none;"{% endif %}>
                        <label class="block text-sm font-medium text-gray-700">Autre nature juridique</label>
                        {{ form.autre_nature_juridique }}
                    </div>
                </div>
        
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Superficie de l'atelier (en m²)</label>
                        {{ form.superficie_atelier }}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Statut de l'activité</label>
                        {{ form.statut_activite }}
                    </div>
                </div>
        
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Activité principale</label>
                        {{ form.activite_principale }}
                    </div>
                    <div id="autre_activite_principale_row" {% if form.activite_principale.value != 'autre' %}style="display:none;"{% endif %}>
                        <label class="block text-sm font-medium text-gray-700">Autre activité principale</label>
                        {{ form.autre_activite_principale }}
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Section 37-50: Ressources humaines et équipements -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-users-cog me-2"></i>37-50. Ressources humaines et équipements</h5>
            </div>
            <div class="section-card bg-gray-50 p-4 rounded-lg">
                <div class="row g-3">
                    <div class="col-md-6">{{ form.nombre_total_personnes|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.nombre_proprietaires|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.nombre_ouvriers|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.nombre_apprentis|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.nombre_stagiaires|as_crispy_field }}</div>
                    <!-- formation professionnelle -->
                    <div class="row g-3">
                        <div class="section-card bg-gray-50 p-4 rounded-lg">
                            <label class="block text-sm font-medium text-gray-700 mb-2"> Avez-vous suivi une formation professionnelle ? </label>
                            <div class="flex space-x-4">
                                <div class="flex items-center">
                                    <input type="radio" name="formation_professionnelle" id="formation_oui" 
                                           value="True" class="radio-custom"
                                           {% if form.formation_professionnelle.value %}checked{% endif %}>
                                    <label for="formation_oui" class="text-gray-700 cursor-pointer">Oui</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" name="formation_professionnelle" id="formation_non" 
                                           value="False" class="radio-custom"
                                           {% if form.formation_professionnelle.value == False %}checked{% endif %}>
                                    <label for="formation_non" class="text-gray-700 cursor-pointer">Non</label>
                                </div>
                            </div>
                            <div id="ecole_formation_container" class="mt-3 {% if not form.formation_professionnelle.value %}hidden{% endif %}">
                                <label for="{{ form.ecole_formation.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Si Oui, de quelle école/établissement ?
                                </label>
                                {{ form.ecole_formation }}
                                {% if form.ecole_formation.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.ecole_formation.errors %}
                                    <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    <div class="col-md-6">{{ form.formation_ouvriers|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.nombre_personnes_formees|as_crispy_field }}</div>
                    <div class="col-md-12">{{ form.duree_apprentissage|as_crispy_field }}</div>
                    
                    <div class="col-md-12">
                        <h6 class="border-bottom pb-2">48. Équipements disponibles</h6>
                        <div class="section-card bg-gray-50 p-4 rounded-lg">
                            <div class="col-md-4">{{ form.electricite|as_crispy_field }}</div>
                            <div class="col-md-4">{{ form.eau_courante|as_crispy_field }}</div>
                            <div class="col-md-4">{{ form.espace_stockage|as_crispy_field }}</div>
                            <div class="col-md-4">{{ form.materiel_levage|as_crispy_field }}</div>
                            <div class="col-md-4">{{ form.banc_diagnostic|as_crispy_field }}</div>
                            <div class="col-md-4">{{ form.outillage_specialise|as_crispy_field }}</div>
                            <div class="col-md-12" id="type_outillage_row" {% if not form.outillage_specialise.value %}style="display:none;"{% endif %}>
                                {{ form.type_outillage|as_crispy_field }}
                            </div>
                        </div>
                    </div>
                    <!-- Accès internet -->
                <div class="section-card bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Avez-vous un accès à l’Internet ou à un smartphone connecté ?</label>
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input type="radio" name="acces_internet" id="internet_oui" 
                                   value="True" class="radio-custom"
                                   {% if form.acces_internet.value %}checked{% endif %}>
                            <label for="internet_oui" class="text-gray-700 cursor-pointer">Oui</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="acces_internet" id="internet_non" 
                                   value="False" class="radio-custom"
                                   {% if form.acces_internet.value == False %}checked{% endif %}>
                            <label for="internet_non" class="text-gray-700 cursor-pointer">Non</label>
                        </div>
                    </div>
                    {% if form.acces_internet.errors %}
                    <div class="mt-1 text-sm text-red-600">
                        {% for error in form.acces_internet.errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                </div>
            </div>
        </div>

        <!-- Section 51-60: Besoins et impacts -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-clipboard-list me-2"></i>51-60. Besoins et impacts</h5>
            </div>
            <div class="section-card bg-gray-50 p-4 rounded-lg">
                <div class="row g-3">
                    <h6 class="border-bottom pb-2">51. Besoins en formation technique</h6>
                    <div class="col-md-4">{{ form.besoin_diagnostic|as_crispy_field }}</div>
                    <div class="col-md-4">{{ form.besoin_vehicules_hybrides|as_crispy_field }}</div>
                    <div class="col-md-4">{{ form.besoin_gestion_atelier|as_crispy_field }}</div>
                    <div class="col-md-4">{{ form.besoin_relation_client|as_crispy_field }}</div>
                    <div class="col-md-4">{{ form.besoin_froid_climatisation|as_crispy_field }}</div>
                    <div class="col-md-12" id="autres_besoins_formation_row">
                        {{ form.autres_besoins_formation|as_crispy_field }}
                    </div>
                    
                <!-- Formalisation -->
                <div class="section-card bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Êtes-vous disposé à formaliser votre activité si un appui est proposé ?</label>
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input type="radio" name="dispose_formaliser" id="formalisation_oui" 
                                   value="True" class="radio-custom"
                                   {% if form.dispose_formaliser.value %}checked{% endif %}>
                            <label for="formalisation_oui" class="text-gray-700 cursor-pointer">Oui</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="dispose_formaliser" id="formalisation_non" 
                                   value="False" class="radio-custom"
                                   {% if form.dispose_formaliser.value == False %}checked{% endif %}>
                            <label for="formalisation_non" class="text-gray-700 cursor-pointer">Non</label>
                        </div>
                    </div>
                    <div id="accompagnement_container" class="mt-3 {% if not form.dispose_formaliser.value %}hidden{% endif %}">
                        <label for="{{ form.type_accompagnement.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            Quel type d’accompagnement auriez-vous besoin ?
                        </label>
                        {{ form.type_accompagnement }}
                        {% if form.type_accompagnement.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.type_accompagnement.errors %}
                            <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                     <!-- Affiliation OPA -->
                <div class="section-card bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Êtes-vous affilié à une Organisation Professionnelle Artisanale (OPA) ? </label>
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input type="radio" name="affilie_opa" id="opa_oui" 
                                   value="True" class="radio-custom"
                                   {% if form.affilie_opa.value %}checked{% endif %}>
                            <label for="opa_oui" class="text-gray-700 cursor-pointer">Oui</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="affilie_opa" id="opa_non" 
                                   value="False" class="radio-custom"
                                   {% if form.affilie_opa.value == False %}checked{% endif %}>
                            <label for="opa_non" class="text-gray-700 cursor-pointer">Non</label>
                        </div>
                    </div>
                    <div id="nom_opa_container" class="mt-3 {% if not form.affilie_opa.value %}hidden{% endif %}">
                        <label for="{{ form.nom_opa.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            Laquelle ?
                        </label>
                        {{ form.nom_opa }}
                        {% if form.nom_opa.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.nom_opa.errors %}
                            <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                    <div class="col-md-12">{{ form.horaires_occupation|as_crispy_field }}</div>
                    <!-- impact positif et negatif -->
                    <div class="section-card bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Quels sont les impacts de votre activité sur l'environnement immédiat?
                        </label>

                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" name="impact_environnement" id="impact_oui" 
                                    value="positifs" class="radio-custom"
                                    {% if form.impact_environnement.value == 'positifs'  %}checked{% endif %}>
                                <label for="impact_oui" class="ml-1 text-gray-700 cursor-pointer">Positifs</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="impact_environnement" id="impact_non" 
                                    value="negatifs" class="radio-custom"
                                    {% if form.impact_environnement.value == 'negatifs' or not form.impact_environnement.value %}checked{% endif %}>
                                <label for="impact_non" class="ml-1 text-gray-700 cursor-pointer">Negatifs</label>
                            </div>
                        </div>
                        <div id="impact_container" class="mt-3 {% if form.impact_environnement.value != 'positifs' %}hidden{% endif %}">
                            <label for="{{ form.avantages_positifs.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Si Positifs , quels avantages, quels bénéfices?
                            </label>
                            {{ form.avantages_positifs }}
                            {% if form.avantages_positifs.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.avantages_positifs.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                
                        <!-- Si negatifs -->
                        <div id="impact_negatif_container" class="mt-3 {% if form.impact_environnement.value != 'negatifs' %}hidden{% endif %}">
                            <label for="{{ form.inconvenients_negatifs.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Si Négatifs,quels inconvénients, quels problèmes?
                            </label>
                            {{ form.inconvenients_negatifs }}
                            {% if form.inconvenients_negatifs.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.inconvenients_negatifs.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 61-72: Gestion des déchets et relations -->
        <div class="mb-6 border border-gray-200 rounded-lg shadow">
            <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold">
                <h5><i class="fas fa-trash-alt me-2"></i>61-72. Gestion des déchets et relations</h5>
            </div>
            <div class="section-card bg-gray-50 p-4 rounded-lg">
                <div class="row g-3">
                    <!-- Section : Gestion des déchets -->
                    <div class="section-card bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Votre activité génère-t-elle des déchets ?
                        </label>
                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" name="genere_dechets" id="genere_oui" value="True"
                                    class="radio-custom"
                                    {% if form.genere_dechets.value == 'True' %}checked{% endif %}>
                                <label for="genere_oui" class="text-gray-700 cursor-pointer ml-1">Oui</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="genere_dechets" id="genere_non" value="False"
                                    class="radio-custom"
                                    {% if form.genere_dechets.value == 'False' or not form.genere_dechets.value %}checked{% endif %}>
                                <label for="genere_non" class="text-gray-700 cursor-pointer ml-1">Non</label>
                            </div>
                        </div>

                        <!-- Si oui : gestion des déchets -->
                        <div id="dechet_container" class="mt-3 {% if form.genere_dechets.value != 'True' %}hidden{% endif %}">
                            <label for="{{ form.gestion_dechets.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Si oui, comment sont-ils gérés ?
                            </label>
                            <div class="text-gray-700">
                                {{ form.gestion_dechets }}
                            </div>

                            <!-- Si autre est sélectionné -->
                            <div id="gestion_container" class="mt-3 {% if form.gestion_dechets.value != 'autre' %}hidden{% endif %}">
                                <label for="{{ form.autre_gestion_dechets.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Lequel autre ?
                                </label>
                                <div class="text-gray-700">
                                    {{ form.autre_gestion_dechets }}
                                </div>
                            </div>

                            <!-- Erreurs -->
                            {% if form.gestion_dechets.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {% for error in form.gestion_dechets.errors %}
                                <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    
                    <!-- relations avec les autres occupants -->
                    <div class="section-card bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Avez-vous des relations avec les autres occupants informels du même espace?</label>
                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" name="relations_occupants" id="relations_oui" 
                                       value="True" class="radio-custom"
                                       {% if form.relations_occupants.value %}checked{% endif %}>
                                <label for="relations_oui" class="text-gray-700 cursor-pointer">Oui</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="relations_occupants" id="relations_non" 
                                       value="False" class="radio-custom"
                                       {% if form.relations_occupants.value == False %}checked{% endif %}>
                                <label for="relations_non" class="text-gray-700 cursor-pointer">Non</label>
                            </div>
                        </div>
                        {% if form.relations_occupants.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.relations_occupants.errors %}
                            <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>


                    <!--  problèmes avec les autorités -->
                    <div class="section-card bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Avez-vous déjà eu des problèmes avec les autorités ou d'autres personnes à cause de cette occupation?
                        </label>
                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" name="problemes_autorites" id="probleme_oui" value="True"
                                    class="radio-custom"
                                    {% if form.problemes_autorites.value == 'True' %}checked{% endif %}>
                                <label for="probleme_oui" class="text-gray-700 cursor-pointer ml-1">Oui</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="problemes_autorites" id="probleme_non" value="False"
                                    class="radio-custom"
                                    {% if form.problemes_autorites.value == 'False' or not form.problemes_autorites.value %}checked{% endif %}>
                                <label for="probleme_non" class="text-gray-700 cursor-pointer ml-1">Non</label>
                            </div>
                        </div>

                        <!-- Si oui : probleme -->
                        <div id="probleme_container" class="mt-3 {% if form.problemes_autorites.value != 'True' %}hidden{% endif %}">
                            <label for="{{ form.autorite_probleme.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                 Si Oui lequel autorité ?
                            </label>
                            <div class="text-gray-700">
                                {{ form.autorite_probleme }}
                            </div>

                            <!-- Si autre est sélectionné -->
                            <div id="autorite_container" class="mt-3 {% if form.autorite_probleme.value != 'autre' %}hidden{% endif %}">
                                <label for="{{ form.autre_autorite.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                    Lequel autre ?
                                </label>
                                <div class="text-gray-700">
                                    {{ form.autre_autorite }}
                                </div>
                            </div>

                            <!-- Erreurs -->
                            {% if form.autorite_container.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {% for error in form.autorite_container.errors %}
                                <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>


                    <div class="col-md-12">{{ form.avantages_commune|as_crispy_field }}</div>
                    <div class="col-md-12">{{ form.inconvenients_commune|as_crispy_field }}</div>
                    <div class="col-md-12">{{ form.opinion_reglementation|as_crispy_field }}</div>
                    <div class="col-md-12">{{ form.suggestions|as_crispy_field }}</div>
                    
                        <!-- prêt à déménager -->
                    <div class="section-card bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Seriez-vous prêt à déménager si un espace adapté vous était proposé ?
                        </label>

                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" name="pret_demenager" id="pret_oui" 
                                    value="True" class="radio-custom"
                                    {% if form.pret_demenager.value == 'True' %}checked{% endif %}>
                                <label for="pret_oui" class="ml-1 text-gray-700 cursor-pointer">Oui</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="pret_demenager" id="pret_non" 
                                    value="False" class="radio-custom"
                                    {% if form.pret_demenager.value == 'False' or not form.pret_demenager.value %}checked{% endif %}>
                                <label for="pret_non" class="ml-1 text-gray-700 cursor-pointer">Non</label>
                            </div>
                        </div>
                        <div id="pret_container" class="mt-3 {% if form.pret_demenager.value != 'True' %}hidden{% endif %}">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Si oui, êtes-vous prêt à exercer votre métier hors de Dakar ?
                            </label>
                            <div class="flex space-x-4">
                                <!-- Oui -->
                                <div class="flex items-center">
                                    <input type="radio" name="pret_exercer_hors_dakar" id="hors_oui" value="True" class="radio-custom"
                                            {% if form.pret_exercer_hors_dakar.value == 'True' %}checked{% endif %}>
                                    <label for="hors_oui" class="ml-1 text-gray-700 cursor-pointer">Oui</label>
                                </div>
                                <!-- Non -->
                                <div class="flex items-center">
                                    <input type="radio" name="pret_exercer_hors_dakar" id="hors_non" value="False" class="radio-custom"
                                            {% if form.pret_exercer_hors_dakar.value == 'False' %}checked{% endif %}>
                                    <label for="hors_non" class="ml-1 text-gray-700 cursor-pointer">Non</label>
                                </div>
                            </div>
                        
                            {% if form.pret_exercer_hors_dakar.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.pret_exercer_hors_dakar.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                
                        <!-- Si NON -->
                        <div id="pret_non_container" class="mt-3 {% if form.pret_demenager.value != 'False' %}hidden{% endif %}">
                            <label for="{{ form.raison_refus_dakar.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Si non, pourquoi ?
                            </label>
                            {{ form.raison_refus_dakar }}
                            {% if form.raison_refus_dakar.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.raison_refus_dakar.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>


                    <div class="col-md-12" id="raison_refus_dakar_row" {% if form.pret_exercer_hors_dakar.value %}style="display:none;"{% endif %}>
                        {{ form.raison_refus_dakar|as_crispy_field }}
                    </div>
                    <div class="col-md-12">{{ form.equipements_souhaites|as_crispy_field }}</div>
                </div>
            </div>
        </div>

            <!-- Section 76-82: Accessibilité et commentaires -->
            <div class="mb-6 border border-gray-200 rounded-lg shadow">
                <div class="bg-emerald-600 px-4 py-2 rounded-t-lg text-white font-semibold flex items-center gap-2">
                  <i class="fas fa-map-marked-alt"></i>
                  <h5>76-82. Accessibilité et commentaires</h5>
                </div>
              
                <div class="bg-gray-50 p-6 space-y-6">
              
                  <!-- Difficultés d'accès -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      Avez-vous des difficultés pour accéder à votre lieu d'activité ?
                    </label>
                    <div class="flex space-x-6">
                      <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="radio" name="difficulte_acces" id="difficulte_oui" value="True"
                               class="text-emerald-600 focus:ring-emerald-500"
                               {% if form.difficulte_acces.value == 'True' %}checked{% endif %}>
                        <span>Oui</span>
                      </label>
                      <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="radio" name="difficulte_acces" id="difficulte_non" value="False"
                               class="text-emerald-600 focus:ring-emerald-500"
                               {% if form.difficulte_acces.value == 'False' or not form.difficulte_acces.value %}checked{% endif %}>
                        <span>Non</span>
                      </label>
                    </div>
                    {% if form.difficulte_acces.errors %}
                      <div class="mt-1 text-sm text-red-600">
                        {% for error in form.difficulte_acces.errors %}
                          <p>{{ error }}</p>
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
              
                  <!-- Champs d'information -->
              
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label for="{{ form.lieu_origine.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.lieu_origine.label }}
                      </label>
                      {{ form.lieu_origine }}
                      {% if form.lieu_origine.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.lieu_origine.errors|join:", " }}</p>
                      {% endif %}
                    </div>
              
                    <div>
                      <label for="{{ form.temps_acces.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.temps_acces.label }}
                      </label>
                      {{ form.temps_acces }}
                      {% if form.temps_acces.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.temps_acces.errors|join:", " }}</p>
                      {% endif %}
                    </div>
              
                    <div>
                      <label for="{{ form.lieu_residence_clientele.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.lieu_residence_clientele.label }}
                      </label>
                      {{ form.lieu_residence_clientele }}
                      {% if form.lieu_residence_clientele.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.lieu_residence_clientele.errors|join:", " }}</p>
                      {% endif %}
                    </div>
              
                    <div class="md:col-span-2">
                      <label for="{{ form.commentaires_supplementaires.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.commentaires_supplementaires.label }}
                      </label>
                      {{ form.commentaires_supplementaires }}
                      {% if form.commentaires_supplementaires.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.commentaires_supplementaires.errors|join:", " }}</p>
                      {% endif %}
                    </div>
              
                    <div class="md:col-span-2">
                      <label for="{{ form.commentaire_enqueteur.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.commentaire_enqueteur.label }}
                      </label>
                      {{ form.commentaire_enqueteur }}
                      {% if form.commentaire_enqueteur.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.commentaire_enqueteur.errors|join:", " }}</p>
                      {% endif %}
                    </div>
              
                    <div class="md:col-span-2">
                      <label for="{{ form.photo_atelier.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ form.photo_atelier.label }}
                      </label>
                      {{ form.photo_atelier }}
                      {% if form.photo_atelier.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.photo_atelier.errors|join:", " }}</p>
                      {% endif %}
                    </div>
                  </div>
              
                </div>
              </div>
              

    <!-- Boutons Annuler et Enregistrer -->
    <div class="flex justify-between mt-6 mb-10">
        <a href="{% url 'enquete:liste_enquetes' %}"
        class="inline-flex items-center px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition">
        <i class="fas fa-arrow-left me-2"></i>
        <span class="ml-2">Annuler</span>
        </a>
    
        <button type="submit"
                class="inline-flex items-center px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1 transition">
        <i class="fas fa-save me-2"></i>
        <span class="ml-2">Enregistrer</span>
        </button>
    </div>
  
    </form>
</div>
{% endblock %}

{% block javascript %}
<script>
$(document).ready(function() {
    // Gestion dynamique des champs conditionnels
    function toggleField(triggerId, targetSelector, triggerValue, displayStyle = 'block') {
        const trigger = $(triggerId);
        const target = $(targetSelector);
        
        function update() {
            if (trigger.is(':checkbox, :radio')) {
                target.toggle(trigger.is(':checked') && (triggerValue === undefined || trigger.val() === triggerValue));
            } else {
                target.toggle(trigger.val() === triggerValue);
            }
        }
        
        trigger.change(update);
        update(); // Initialisation
    }

    // Configuration des champs conditionnels
    toggleField('#id_niveau_etude', '#autre_niveau_etude_row', 'autre');
    toggleField('#id_type_activite', '#autre_activite_row', 'autre');
    toggleField('#id_activite_principale', '#autre_activite_principale_row', 'autre');
    toggleField('#id_statut_occupation', '#statut_non_proprietaire_section', 'exploitant_non_proprietaire');
    toggleField('#id_statut_non_proprietaire', '#autre_statut_non_proprietaire_row', 'autre');
    toggleField('#id_statut_non_proprietaire', '#loyer_mensuel_row', 'locataire');
    toggleField('#id_acquisition_site', '#autre_acquisition_row', 'autre');
    toggleField('#id_deja_deguerpi', '#lieu_provenance_row');
    toggleField('#id_menaces_expulsion', '#auteur_menaces_row');
    toggleField('#id_nature_juridique', '#autre_nature_juridique_row', 'autre');
    toggleField('#id_formation_professionnelle', '#ecole_formation_row');
    toggleField('#id_outillage_specialise', '#type_outillage_row');
    toggleField('#id_dispose_formaliser', '#type_accompagnement_row');
    toggleField('#id_affilie_opa', '#nom_opa_row');
    toggleField('#id_impact_environnement', '#avantages_positifs_row', 'positifs');
    toggleField('#id_impact_environnement', '#inconvenients_negatifs_row', 'negatifs');
    toggleField('#id_genere_dechets', '#gestion_dechets_row');
    toggleField('#id_gestion_dechets', '#autre_gestion_dechets_row', 'autre');
    toggleField('#id_problemes_autorites', '#autorite_probleme_row');
    toggleField('#id_autorite_probleme', '#autre_autorite_row', 'autre');
    toggleField('#id_pret_exercer_hors_dakar', '#raison_refus_dakar_row', false);

    // Validation du formulaire
    (function() {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
});

document.querySelectorAll('input[name="deja_deguerpi"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('lieu_provenance_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="menaces_expulsion"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('auteur_menaces_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="formation_professionnelle"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('ecole_formation_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="dispose_formaliser"]').forEach(input => {
    input.addEventListener('change', function() {
        document.getElementById('accompagnement_container').classList.toggle('hidden', this.value !== 'True');
    });
});

document.querySelectorAll('input[name="affilie_opa"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('nom_opa_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="genere_dechets"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('dechet_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="gestion_dechets"]').forEach(input => {
    input.addEventListener('change', function() {
            document.getElementById('gestion_container').classList.toggle('hidden', this.value !== 'autre');
        });
    });

document.querySelectorAll('input[name="problemes_autorites"]').forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('probleme_container').classList.toggle('hidden', this.value !== 'True');
        });
    });

document.querySelectorAll('input[name="autorite_probleme"]').forEach(input => {
    input.addEventListener('change', function() {
            document.getElementById('autorite_container').classList.toggle('hidden', this.value !== 'autre');
        });
    });

document.querySelectorAll('input[name="pret_demenager"]').forEach(input => {
    input.addEventListener('change', function() {
        document.getElementById('pret_container').classList.toggle('hidden', this.value !== 'True');
        document.getElementById('pret_non_container').classList.toggle('hidden', this.value !== 'False');
    });
});

document.querySelectorAll('input[name="impact_environnement"]').forEach(input => {
    input.addEventListener('change', function() {
        document.getElementById('impact_container').classList.toggle('hidden', this.value !== 'positifs');
        document.getElementById('impact_negatif_container').classList.toggle('hidden', this.value !== 'negatifs');
    });
});

</script>
{% endblock %}